<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Accounting</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif; margin:20px;}
    .nav{margin-bottom:16px}
    .nav a{text-decoration:none; padding:6px 10px; border:1px solid #ccc; border-radius:6px; background:#f7f7f7}
    table{border-collapse:collapse; margin-top:10px}
    th, td{border:1px solid #ddd; padding:8px}
  </style>
</head>
<body>
  <div class="nav"><a href="index.html">⬅ Back to Main</a></div>
  <h1>Accounting</h1>
  <div id="msg">Loading…</div>

  <table>
    <thead><tr><th></th><th>Taxable</th><th>Non-Taxable</th><th>Total</th></tr></thead>
    <tbody>
      <tr><td>Income</td><td id="p_tax">–</td><td id="p_ntax">–</td><td id="p_all">–</td></tr>
      <tr><td>Expenses</td><td id="e_tax">–</td><td id="e_ntax">–</td><td id="e_all">–</td></tr>
      <tr><td><b>Net</b></td><td id="n_tax">–</td><td id="n_ntax">–</td><td id="n_all">–</td></tr>
    </tbody>
  </table>

<script>
async function fetchJSON(url){
  const r = await fetch(url);
  const t = await r.text();
  try { return JSON.parse(t) } catch { return { ok:false, error:'Invalid JSON', raw:t } }
}
function num(x){ return Number(x||0).toFixed(2); }
(async ()=>{
  const data = await fetchJSON('/api/accounting');
  const msg = document.getElementById('msg');
  if (!data.ok){
    msg.textContent = 'Error: ' + (data.error || 'invalid JSON');
    console.error('Accounting raw:', data.raw);
    return;
  }
  msg.textContent = '';
  document.getElementById('p_tax').textContent = num(data.payments.taxable);
  document.getElementById('p_ntax').textContent = num(data.payments.nonTaxable);
  document.getElementById('p_all').textContent  = num(data.payments.total);

  document.getElementById('e_tax').textContent = num(data.expenses.taxable);
  document.getElementById('e_ntax').textContent = num(data.expenses.nonTaxable);
  document.getElementById('e_all').textContent  = num(data.expenses.total);

  document.getElementById('n_tax').textContent = num(data.net.taxable);
  document.getElementById('n_ntax').textContent = num(data.net.nonTaxable);
  document.getElementById('n_all').textContent  = num(data.net.total);
})();
</script>
</body>
</html>
